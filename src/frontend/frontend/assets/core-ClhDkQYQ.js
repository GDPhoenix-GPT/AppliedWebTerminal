var a=Object.defineProperty;var c=(s,e,t)=>e in s?a(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var i=(s,e,t)=>c(s,typeof e!="symbol"?e+"":e,t);import{u as h}from"./data-DstSTGou.js";import{L as o}from"./utils-DPPkojbW.js";class f{constructor(){i(this,"_token");i(this,"_webSocket");i(this,"_onOpenListeners",new Map);i(this,"_onMessageListeners",new Map);i(this,"_onErrorListeners",new Map);i(this,"_onCloseListeners",new Map)}_onOpen(e){o.info("WebSocket Service doing onOpen"),this._onOpenListeners.forEach((t,n)=>{t(e)})}_onMessage(e){this._onOpenListeners.forEach((t,n)=>{t(e)})}_onError(e){this._onErrorListeners.forEach((t,n)=>{t(e)})}_onClose(e){this._onCloseListeners.forEach((t,n)=>{t(e)})}addOnOpenListener(e,t){return this._onOpenListeners.set(e,t),this}removeOnOpenListener(e){return this._onOpenListeners.delete(e),this}addOnMessageListener(e,t){return this._onMessageListeners.set(e,t),this}removeOnMessageListener(e){return this._onMessageListeners.delete(e),this}addOnCloseListener(e,t){return this._onCloseListeners.set(e,t),this}removeOnCloseListener(e){return this._onCloseListeners.delete(e),this}addOnErrorListener(e,t){return this._onErrorListeners.set(e,t),this}removeOnErrorListener(e){return this._onErrorListeners.delete(e),this}setToken(e){return this._token=e,this}connect(e=this._token){o.info(`connecting to WebSocket with token : ${e}`),this._token||(this._token=e),this._webSocket&&this.close();const r=h().serverConfig.webSocketUrl||`ws://${location.host}/ws`;this._webSocket=new WebSocket(`${r}?token=${e}`),this._webSocket.addEventListener("open",this._onOpen.bind(this)),this._webSocket.addEventListener("message",this._onMessage.bind(this)),this._webSocket.addEventListener("close",this._onClose.bind(this)),this._webSocket.addEventListener("error",this._onError.bind(this))}send(e){var t;(t=this._webSocket)==null||t.send(e)}get readyState(){var e;return(e=this._webSocket)==null?void 0:e.readyState}get url(){var e;return(e=this._webSocket)==null?void 0:e.url}close(){var e;o.info("Closing WebSocket"),(e=this._webSocket)==null||e.close(),this._webSocket=void 0}}async function L(){o.info("Fetching Terminal list...");const s=await fetch("/list",{cache:"no-cache"});if(s.ok){const e=await s.json();return o.info("Fetch Terminal list successfully."),o.info(e),e}return[]}async function w(s,e){const n=await fetch("/login",{cache:"no-cache",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuid:s,password:e})});if(n.ok)try{const r=await n.json();return r.success&&r.payload?r.payload:0}catch{return 1}return 1}async function p(s,e,t){if(t.translateCache.has(e)&&t.translateCache.set(e,new Map),t.translateCache.get(e).has(s))return t.translateCache.get(e).get(s);const n=await fetch(`/translate/${e}/${s}`);if(n.ok){const r=await n.text();return t.translateCache.get(e).set(s,r),r}}export{f as W,L as a,p as f,w as l};
