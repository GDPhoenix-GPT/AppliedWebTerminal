var _=Object.defineProperty;var g=(n,e,t)=>e in n?_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>g(n,typeof e!="symbol"?e+"":e,t);import{u as f,b as d}from"./data-Dg-AU-9l.js";import{L as i}from"./utils-BS2FQLbZ.js";import{s as u}from"./node-modules_sprintf-js-D7DtBTRn.js";class b{constructor(){r(this,"_token");r(this,"_webSocket");r(this,"_onOpenListeners",new Map);r(this,"_onMessageListeners",new Map);r(this,"_onErrorListeners",new Map);r(this,"_onCloseListeners",new Map)}_onOpen(e){i.info("WebSocket Service doing onOpen"),this._onOpenListeners.forEach((t,s)=>{t(e)})}_onMessage(e){this._onOpenListeners.forEach((t,s)=>{t(e)})}_onError(e){this._onErrorListeners.forEach((t,s)=>{t(e)})}_onClose(e){this._onCloseListeners.forEach((t,s)=>{t(e)})}addOnOpenListener(e,t){return this._onOpenListeners.set(e,t),this}removeOnOpenListener(e){return this._onOpenListeners.delete(e),this}addOnMessageListener(e,t){return this._onMessageListeners.set(e,t),this}removeOnMessageListener(e){return this._onMessageListeners.delete(e),this}addOnCloseListener(e,t){return this._onCloseListeners.set(e,t),this}removeOnCloseListener(e){return this._onCloseListeners.delete(e),this}addOnErrorListener(e,t){return this._onErrorListeners.set(e,t),this}removeOnErrorListener(e){return this._onErrorListeners.delete(e),this}setToken(e){return this._token=e,this}connect(e=this._token,t="cpuMonitor"){i.info(`connecting to WebSocket with token : ${e}`),this._token||(this._token=e),this._webSocket&&this.close();const a=`${f().serverConfig.webSocketUrl}/${t}`||`ws://${location.host}/${t}`;this._webSocket=new WebSocket(`${a}?token=${e}`),this._webSocket.addEventListener("open",this._onOpen.bind(this)),this._webSocket.addEventListener("message",this._onMessage.bind(this)),this._webSocket.addEventListener("close",this._onClose.bind(this)),this._webSocket.addEventListener("error",this._onError.bind(this))}send(e){var t;(t=this._webSocket)==null||t.send(e)}get readyState(){var e;return(e=this._webSocket)==null?void 0:e.readyState}get url(){var e;return(e=this._webSocket)==null?void 0:e.url}close(){var e;i.info("Closing WebSocket"),(e=this._webSocket)==null||e.close(),this._webSocket=void 0}}const h=new Map;function O(n,...e){var o;const t=f();let s=(o=h.get(t.localConfig.language))==null?void 0:o.get(n);return s!==void 0?u.vsprintf(s,e):p(n,e)}function p(n,...e){var s;let t=(s=h.get("en_us"))==null?void 0:s.get(n);return t!==void 0?u.vsprintf(t,e):n}async function m(){const n=await fetch("/lang/all.json");if(!n.ok)return;const e=await n.json();for(let t=0;t<e.length;t++){const s=e[t],o=await fetch(`/lang/${s}`);if(!o.ok)return;const a=new Map(Object.entries(await o.json()));h.set(s.replace(".json",""),a)}}async function E(n,e){return d().getTranslation(e,n)}const c=["","K","M","G","T"],l=10**3;function v(n){if(n<1e4)return n.toString();let e=0,t=n;for(;t>l&&e<c.length;)t=t/l,e++;return e>=c.length?n.toExponential(2):`${t.toFixed(1)}${c[e]}`}async function M(){i.info("Fetching Terminal list...");const n=await fetch("/list",{cache:"no-cache"});if(n.ok){const e=await n.json();return i.info("Fetch Terminal list successfully."),i.info(e),e}return[]}async function $(n,e){const s=await fetch("/login",{cache:"no-cache",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuid:n,password:e})});if(s.ok)try{const o=await s.json();return o.success&&o.payload?o.payload:0}catch{return 1}return 1}async function C(n,e,t,s){const o=await fetch(`/storage?page=${n}&limit=${e}&sort=${t}`,{headers:{Authorization:`Bearer ${s}`}});if(o.ok)return await o.json()}export{b as W,v as a,M as b,C as c,E as f,m as i,$ as l,O as t};
